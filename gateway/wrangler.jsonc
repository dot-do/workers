/**
 * Gateway Service Configuration
 *
 * For more details on Wrangler configuration:
 * https://developers.cloudflare.com/workers/wrangler/configuration/
 */
{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "do-gateway",
	"main": "src/index.ts",
	"compatibility_date": "2025-07-08",
	"observability": { "enabled": true },

	/**
	 * Routes - Gateway handles all traffic
	 * Uncomment to route specific domains through this gateway
	 */
	// "routes": [
	// 	{ "pattern": "api.services.do/*", "zone_name": "services.do" },
	// 	{ "pattern": "*.api.mw/*", "zone_name": "api.mw" }
	// ],

	/**
	 * Smart Placement - Let Cloudflare optimize worker placement
	 */
	"placement": { "mode": "smart" },

	/**
	 * Service Bindings - RPC connections to all microservices
	 * Each binding provides a typed RPC interface to call methods directly
	 */
	"services": [
		// Core services
		{ "binding": "DB", "service": "do-db" },
		{ "binding": "AI", "service": "do-ai" },
		{ "binding": "AUTH", "service": "do-auth" },

		// Data services
		{ "binding": "RELATIONSHIPS", "service": "do-relationships" },
		{ "binding": "EMBEDDINGS", "service": "do-embeddings" },

		// Processing services
		{ "binding": "QUEUE", "service": "do-queue" },
		{ "binding": "BATCH", "service": "do-batch" },
		{ "binding": "SCHEDULE", "service": "do-schedule" },
		{ "binding": "WORKFLOWS", "service": "do-workflows" },

		// Execution services
		{ "binding": "CODE_EXEC", "service": "do-code-exec" },
		{ "binding": "CLAUDE_CODE", "service": "do-claude-code" },

		// Durable Object services
		{ "binding": "EVENTS", "service": "do-events" }
	],

	/**
	 * KV Namespace - For distributed rate limiting and caching
	 */
	"kv_namespaces": [
		{
			"binding": "GATEWAY_KV",
			"id": "placeholder-kv-namespace-id"
			// Update with actual KV namespace ID after creation:
			// wrangler kv:namespace create "GATEWAY_KV"
		}
	],

	/**
	 * D1 Database - Optional, for gateway configuration and analytics
	 */
	// "d1_databases": [
	// 	{
	// 		"binding": "GATEWAY_DB",
	// 		"database_name": "gateway",
	// 		"database_id": "placeholder-d1-database-id"
	// 	}
	// ],

	/**
	 * Environment Variables
	 * Note: Secrets should be set via `wrangler secret put`
	 */
	"vars": {
		"ENVIRONMENT": "production"
	}

	/**
	 * Secrets (set via CLI, not committed to version control)
	 *
	 * Set these with:
	 * wrangler secret put WORKOS_API_KEY
	 * wrangler secret put WORKOS_CLIENT_ID
	 */
	// WORKOS_API_KEY
	// WORKOS_CLIENT_ID
}
